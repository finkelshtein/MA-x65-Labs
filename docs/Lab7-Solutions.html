<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lab 7 - Solutions: Kaplan–Meier estimate of the survival functions and Cox regression model – MA-365/M65 Lab Assignments</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Lab6-Solutions.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8fef5d38915f831591fa3b4cafce98b5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Lab 7 - Solutions: Kaplan–Meier estimate of the survival functions and Cox regression model – MA-365/M65 Lab Assignments">
<meta property="og:description" content="Lab Assignments for module MA-365/M65: Risk and Survival Models">
<meta property="og:image" content="https://finkelshtein.github.io/MA-x65/website/Lab7-Solutions_files/figure-html/unnamed-chunk-7-1.png">
<meta property="og:site_name" content="MA-365/M65 Lab Assignments">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Lab1-Solutions.html">Labs - Solutions</a></li><li class="breadcrumb-item"><a href="./Lab7-Solutions.html">Lab 7 - Solutions</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/graph.jpg" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="./images/graph.jpg" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Site overview</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Labs - Problems</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1 - Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2 - Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3 - Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4 - Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 5 - Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 6 - Problems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 7 - Problems</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Labs - Solutions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab1-Solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1 - Solutions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab2-Solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2 - Solutions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab3-Solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3 - Solutions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab4-Solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4 - Solutions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab5-Solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 5 - Solutions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab6-Solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 6 - Solutions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Lab7-Solutions.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Lab 7 - Solutions</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#reminder-about-data-frames" id="toc-reminder-about-data-frames" class="nav-link active" data-scroll-target="#reminder-about-data-frames"><span class="header-section-number">1</span> Reminder about data frames</a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">1.1</span> </a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1"><span class="header-section-number">1.2</span> </a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"><span class="header-section-number">1.3</span> </a></li>
  </ul></li>
  <li><a href="#kaplanmeier-estimate" id="toc-kaplanmeier-estimate" class="nav-link" data-scroll-target="#kaplanmeier-estimate"><span class="header-section-number">2</span> Kaplan–Meier estimate</a>
  <ul class="collapse">
  <li><a href="#section-3" id="toc-section-3" class="nav-link" data-scroll-target="#section-3"><span class="header-section-number">2.1</span> </a></li>
  </ul></li>
  <li><a href="#kaplanmeier-estimate-for-covariates" id="toc-kaplanmeier-estimate-for-covariates" class="nav-link" data-scroll-target="#kaplanmeier-estimate-for-covariates"><span class="header-section-number">3</span> Kaplan–Meier estimate for covariates</a>
  <ul class="collapse">
  <li><a href="#section-4" id="toc-section-4" class="nav-link" data-scroll-target="#section-4"><span class="header-section-number">3.1</span> </a></li>
  </ul></li>
  <li><a href="#embedded-data-frames" id="toc-embedded-data-frames" class="nav-link" data-scroll-target="#embedded-data-frames"><span class="header-section-number">4</span> Embedded data frames</a>
  <ul class="collapse">
  <li><a href="#section-5" id="toc-section-5" class="nav-link" data-scroll-target="#section-5"><span class="header-section-number">4.1</span> </a></li>
  </ul></li>
  <li><a href="#cox-regression-model" id="toc-cox-regression-model" class="nav-link" data-scroll-target="#cox-regression-model"><span class="header-section-number">5</span> Cox regression model</a>
  <ul class="collapse">
  <li><a href="#section-6" id="toc-section-6" class="nav-link" data-scroll-target="#section-6"><span class="header-section-number">5.1</span> </a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Lab1-Solutions.html">Labs - Solutions</a></li><li class="breadcrumb-item"><a href="./Lab7-Solutions.html">Lab 7 - Solutions</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Lab 7 - Solutions: Kaplan–Meier estimate of the survival functions and Cox regression model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="hidden">
<p><span class="math display">\[
  \renewcommand{\P}{\mathbb{P}}
  \newcommand{\E}{\mathbb{E}}
\]</span></p>
</div>
<section id="reminder-about-data-frames" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Reminder about data frames</h1>
<section id="section" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="section"><span class="header-section-number">1.1</span> </h2>
<div class="task">
<p>Download <a href="hm.csv">hm.csv</a> file, store it at the variable <code>df</code>, and show first rows of the data set. Check the output.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"hm.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  ID time age drug status    entdate    enddate
1  1    5  46    0      1 15/05/2015 14/10/2015
2  2    6  35    1      0 19/09/2014 20/03/2015
3  3    8  30    1      1 21/04/2016 20/12/2016
4  4    3  30    1      1 03/01/2016 04/04/2016
5  5   22  36    0      1 18/09/2014 19/07/2016
6  6    1  32    1      0 18/03/2016 17/04/2016</code></pre>
</div>
</div>
<p>As you can see, this data frame contains some data about patients, who were in a trial. Column “time” tells us how many full months the trial took place place for each patient (we know that it’s “months” time units looking at the last two columns: “entdate” is the dat of the start of the trial for a patient, and the “enddate” is the date of the end of the trial). Column “age” contains obviously their ages. Column “drug” tells us whether they got some medicine effect of which we investigate (<span class="math inline">\(0\)</span> means no, <span class="math inline">\(1\)</span> means yes). Column “status” tells us their status at the end of the trial: <span class="math inline">\(1\)</span> stands for “dead” (because of the drug received), <span class="math inline">\(0\)</span> means “not dead because of the drug”, i.e.&nbsp;censored (excluded from the trial, e.g.&nbsp;recovered and dismissed, or dead by another reason non related to the drug, or something else).</p>
</section>
<section id="section-1" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="section-1"><span class="header-section-number">1.2</span> </h2>
<div class="task">
<p>Find the mean age of the participants of the trial. Check the answer</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(df<span class="sc">$</span>age)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 36.07</code></pre>
</div>
</div>
</section>
<section id="section-2" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="section-2"><span class="header-section-number">1.3</span> </h2>
<div class="task">
<p>Find the number of entries (rows) in the data frame. Check the answer:</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(df<span class="sc">$</span>age)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
</div>
</section>
</section>
<section id="kaplanmeier-estimate" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Kaplan–Meier estimate</h1>
<p>To build the Kaplan-Meier estimate of the survival function based on the data, we will use package <code>survival</code>. Install it, using menu <code>Tools</code> in R Studio and then choosing <code>Install Packages</code> item. Load the installed package in your code:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>First, we need to “label” the data, explaining which entries are censored. For this we use the function <code>Surv</code> (notice the first capital letter!) which has (at least) two arguments, e.g.&nbsp;<code>Surv(time, status)</code>. Here <code>time</code> is a vector containing the data (normally, moments of time), in the example above this data is in the column <code>df$time</code>. Next, <code>status</code> in the <code>Surv</code> function is e.g.&nbsp;a vector of 0/1 or 1/2 where the larger number (1 for 0/1 or 2 for 1/2) means the death because of the considered reason (drug in this example). In our example, we have for this the column <code>df$status</code>. The output is as follows:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Surv</span>(df<span class="sc">$</span>time, df<span class="sc">$</span>status)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1]  5   6+  8   3  22   1+  7   9   3  12   2+ 12   1  15  34   1   4  19+
 [19]  3+  2   2+  6  60+ 11   2+  5   4+  1  13   3   2   1  30   7   4   8 
 [37]  5  10   2   9  36   3   9   3  35   8  11  56+  2+  3  15   1  10   1 
 [55]  7   3   3   2  32   3  10+ 11   3   7   5  31   5  58   1   3+ 43   1 
 [73]  6  53  14   4  54   1   1   8   5   1   1   2   7+  1+ 10  24+  7  12+
 [91]  4  57   1  12+  7   1   5  60+  2+  1 </code></pre>
</div>
</div>
<p>As you can see all censored moments of time got “+” label. Note that the output of <code>Surv</code> function is the so-called “survival object” which has some special internal structure used by R, what we see above is just a visual representation.</p>
<p>Next, to build the Kaplan-Meier estimate of the survival function based on the given data, we use function <code>survfit</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sf <span class="ot">&lt;-</span> <span class="fu">Surv</span>(df<span class="sc">$</span>time, df<span class="sc">$</span>status)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>km <span class="ot">&lt;-</span> <span class="fu">survfit</span>(sf <span class="sc">~</span> <span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>km</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = sf ~ 1)

       n events median 0.95LCL 0.95UCL
[1,] 100     80      7       5      10</code></pre>
</div>
</div>
<p>The symbols <code>~ 1</code> means that we want to build the Kaplan-Meier estimate for the whole (non-censored) data from the data frame regardless of other covariates (characteristics) like age or whether the patient got the drug. The output of <code>survfit</code> (which we stored in <code>km</code> variable) tells us that for <span class="math inline">\(n=100\)</span> patients only <span class="math inline">\(80\)</span> events happened (meaning, in this example, non-censored deaths, i.e.&nbsp;deaths because fo the drug). Again, the output of <code>survfit</code> (stored in <code>km</code>) contains more information, we se only part of it. The usage of this outpus is as follows:</p>
<p>First, we can plot the Kaplan-Meier estimate:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(km)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab7-Solutions_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The solid (middle) line here is actually the graph of the the Kaplan-Meier estimate for the survival function for the given data. The dashed lines show the boundaries of the <span class="math inline">\(0.95\)</span>-confidence interval for such survival functions. It means that the given data is, obviously, just a sample from some large population of patients which got this drug in similar circumnstances (e.g.&nbsp;after the same decease or the same surtgery etc.). If we (hypothetically) would take a large number of samples from this populations (all samples should be of the same length <span class="math inline">\(100\)</span> like in the our example), and if we would plot the Kaplan-Meier estimates for the survival functions in each such sample, then <span class="math inline">\(95\)</span>% of these curves would be in the area bounded by the dashed curves on the plot above.</p>
<p>Note that the value <span class="math inline">\(0.95\)</span> for the confidence interval is the default value, and it can be changed, e.g.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">survfit</span>(sf <span class="sc">~</span> <span class="dv">1</span>), <span class="at">conf.int =</span> <span class="fl">0.99</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab7-Solutions_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As you can see, the area is now “wider” as it should cover a larger number of samples (<span class="math inline">\(99\)</span>%).</p>
<p>Next, we can use the output of <code>survfit</code> to investigate numerical values of the Kaplan-Meier estimate:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(km)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = sf ~ 1)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    1    100      15   0.8500  0.0357       0.7828        0.923
    2     83       5   0.7988  0.0402       0.7237        0.882
    3     73      10   0.6894  0.0473       0.6026        0.789
    4     61       4   0.6442  0.0493       0.5544        0.748
    5     56       7   0.5636  0.0517       0.4709        0.675
    6     49       2   0.5406  0.0521       0.4476        0.653
    7     46       6   0.4701  0.0526       0.3775        0.586
    8     39       4   0.4219  0.0525       0.3306        0.538
    9     35       3   0.3857  0.0520       0.2962        0.502
   10     32       3   0.3496  0.0511       0.2625        0.466
   11     28       3   0.3121  0.0500       0.2280        0.427
   12     25       2   0.2872  0.0490       0.2055        0.401
   13     21       1   0.2735  0.0486       0.1931        0.387
   14     20       1   0.2598  0.0480       0.1809        0.373
   15     19       2   0.2325  0.0467       0.1568        0.345
   22     16       1   0.2179  0.0460       0.1441        0.330
   30     14       1   0.2024  0.0453       0.1305        0.314
   31     13       1   0.1868  0.0444       0.1173        0.298
   32     12       1   0.1712  0.0433       0.1043        0.281
   34     11       1   0.1557  0.0421       0.0916        0.264
   35     10       1   0.1401  0.0407       0.0793        0.247
   36      9       1   0.1245  0.0390       0.0674        0.230
   43      8       1   0.1090  0.0371       0.0559        0.212
   53      7       1   0.0934  0.0349       0.0449        0.194
   54      6       1   0.0778  0.0324       0.0344        0.176
   57      4       1   0.0584  0.0296       0.0216        0.157
   58      3       1   0.0389  0.0253       0.0109        0.139</code></pre>
</div>
</div>
<p>In the output of <code>summary</code>, column <code>time</code> contains the times (the lengths of trials) when non-cesored deaths happened. Column <code>n.risk</code> contains numer of patients who were still under investigation at those times (more precisely, right before those times), and <code>n.event</code> is the number of non-censored deaths which happened at those times. The column <code>survival</code> contains the desired values of the Kaplan-Meier estimate, i.e.</p>
<p><span class="math display">\[
\hat{S}(k)=\mathtt{survival}(\mathtt{time} = k) = \prod_{j\leq k}\biggl( 1-\frac{\mathtt{n.event}(\mathtt{time}=j)}{\mathtt{n.risk}(\mathtt{time}=j)} \biggr).
\]</span></p>
<p>For example, the estimate for the probability that a patient would survive at least <span class="math inline">\(38\)</span> months (after the considered event, say, surgery or desease) is <span class="math inline">\(0.1245\)</span>. Indeed, since <span class="math inline">\(38\)</span> is between <span class="math inline">\(36\)</span> abd <span class="math inline">\(43\)</span> which are present in the <code>time</code> column and the estiamte for the survival function is constant between the given moments of time, then</p>
<p><span class="math display">\[
\hat{S}(38)=\hat{S}(36)= 0.1245.
\]</span></p>
<section id="section-3" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="section-3"><span class="header-section-number">2.1</span> </h2>
<div class="task">
<p>Find out how likely, for the given data, is to survive at least <span class="math inline">\(17\)</span> months than at least <span class="math inline">\(51\)</span> months. Check your answer.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.2325</span><span class="sc">/</span><span class="fl">0.1090</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.133028</code></pre>
</div>
</div>
</section>
</section>
<section id="kaplanmeier-estimate-for-covariates" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Kaplan–Meier estimate for covariates</h1>
<p>Suppose now we want to get Kaplan–Meier estimates for survival functions separately for those who got drugs and those who didn’t. Instead of writing <code>~ 1</code> in <code>survfit</code> function discussed above, we will write <code>~ df$drug</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sf <span class="ot">&lt;-</span> <span class="fu">Surv</span>(df<span class="sc">$</span>time, df<span class="sc">$</span>status)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>kmdrug <span class="ot">&lt;-</span> <span class="fu">survfit</span>(sf <span class="sc">~</span> df<span class="sc">$</span>drug)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>kmdrug</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = sf ~ df$drug)

           n events median 0.95LCL 0.95UCL
df$drug=0 51     42     11       8      30
df$drug=1 49     38      5       3       7</code></pre>
</div>
</div>
<p>Hence, there are <span class="math inline">\(51\)</span> patients who didn’t get drug and <span class="math inline">\(42\)</span> of them aparently died being non-sensored; whereas, there are <span class="math inline">\(49\)</span> patients who got drug and <span class="math inline">\(38\)</span> of them aparently died being non-sensored.</p>
<p>We can plot both survival functions at once:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kmdrug)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab7-Solutions_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The problem is only that we do not see which curves is for whom. We can use e.g.&nbsp;different colours and, most importantly, a legend for the plot:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kmdrug, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"drug=0"</span>,<span class="st">"drug=1"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab7-Solutions_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that <code>lty</code> inside legend tells to draw lines in the legend, where <code>1</code> stands for a solid line (it’s a common agreement in R). For e.g.&nbsp;a dashed line, it would be <span class="math inline">\(2\)</span>.</p>
<section id="section-4" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="section-4"><span class="header-section-number">3.1</span> </h2>
<div class="task">
<p>Plot the previous plot with legend so that <code>drug=0</code> whould be in dashed <code>seagreen</code> colour (both on plot and in legend) and denoted by “No drug”, and <code>drug=1</code> would be in solid orange and denoted “drug”.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kmdrug, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"seagreen"</span>, <span class="st">"orange"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"No drug"</span>,<span class="st">"Drug"</span>),  <span class="at">col=</span><span class="fu">c</span>(<span class="st">"seagreen"</span>, <span class="st">"orange"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab7-Solutions_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="embedded-data-frames" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Embedded data frames</h1>
<p>The data frame <code>lung</code> is embedded into <code>survival</code> package. You can get information about this data frame by typing in the console <code>?lung</code>.</p>
<p>Note that instead of writing e.g.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>kmlung <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(lung<span class="sc">$</span>time, lung<span class="sc">$</span>status) <span class="sc">~</span> lung<span class="sc">$</span>sex)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>kmlung</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(lung$time, lung$status) ~ lung$sex)

             n events median 0.95LCL 0.95UCL
lung$sex=1 138    112    270     212     310
lung$sex=2  90     53    426     348     550</code></pre>
</div>
</div>
<p>one can write</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>kmlung <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>kmlung</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(time, status) ~ sex, data = lung)

        n events median 0.95LCL 0.95UCL
sex=1 138    112    270     212     310
sex=2  90     53    426     348     550</code></pre>
</div>
</div>
<p>that is more compact.</p>
<section id="section-5" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="section-5"><span class="header-section-number">4.1</span> </h2>
<div class="task">
<p>Write the code for the following plot:</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(kmlung,<span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"Male"</span>,<span class="st">"Female"</span>), <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab7-Solutions_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Surely, there numerous R packages which can make plots more nice. For example, may install and load <code>survminer</code> package:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(kmlung)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab7-Solutions_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here “strata” is a synonym for “covariate”. Moreover, by specifying <code>conf.int</code> one can also include the confidence intervals <strong>for both</strong> values of the covariate:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(kmlung, <span class="at">conf.int =</span> <span class="fl">0.95</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab7-Solutions_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note also that if we define <code>kmlung</code> <strong>without</strong> <code>data = lung</code> then <code>ggsurvplot</code> <strong>must include</strong> <code>data = lung</code>: i.e.&nbsp;the full command would be <code>ggsurvplot(survfit(Surv(lung$time, lung$status) ~ lung$sex), data = lung, conf.int = 0.95)</code>.</p>
</section>
</section>
<section id="cox-regression-model" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Cox regression model</h1>
<p>In the above, one had two different estimators for survival functions corresponding to different categories (different values of the covariate <code>sex</code>). The Cox regression model is effective to see a unified estimator for the survival function for both categories.</p>
<p>Recall that the Cox model for one covariate takes the form <span class="math display">\[ \lambda(t,z)=\lambda_0(t)e^{\beta z}, \]</span> where <span class="math inline">\(\beta\in\mathbb{R}\)</span>. In our case, looking at <code>?lung</code>, <span class="math inline">\(z\in\{1,2\}\)</span>, where <span class="math inline">\(z=1\)</span> stands for male and <span class="math inline">\(z=2\)</span> stands for female.</p>
<p>Function <code>coxph</code> calculates the estimate for the parameters <span class="math inline">\(\beta\)</span> and has the same arguments as <code>survfit</code> considered above:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status)<span class="sc">~</span>sex, <span class="at">data=</span>lung)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>fit</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, status) ~ sex, data = lung)

       coef exp(coef) se(coef)      z       p
sex -0.5310    0.5880   0.1672 -3.176 0.00149

Likelihood ratio test=10.63  on 1 df, p=0.001111
n= 228, number of events= 165 </code></pre>
</div>
</div>
<p>Then, the ratio of hazard rates <span class="math display">\[ \frac{\lambda(t,\mathrm{female})}{\lambda(t,\mathrm{male})}=\frac{\lambda_0(t)e^{2\beta}}{\lambda_0(t)e^{\beta}}=e^{\beta}. \]</span></p>
<p>In the output of <code>fit</code>, the value of <code>coef</code> stands for the maximal likelihood estimator (which we denoted as <span class="math inline">\(\beta^*\)</span> on lectures), thus, for the maximal likelihood, looking at the value of <code>exp(coef)</code><br>
<span class="math display">\[  
\frac{\lambda(t,\mathrm{female})}{\lambda(t,\mathrm{male})} = 0.5880,  
\]</span><br>
In other words, based on the data set <code>lung</code> females with advanced lung cancer has approximately <span class="math inline">\(0.59\)</span> times less hazard rates (a.k.a. the force of mortality) than males (calculated at the same moments of time under the treatment).</p>
<p>Note that the command <code>summary(fit)</code> provides more detailed information. In particular, it includes also <code>exp(-coef)</code> that is the inverse ratio: <span class="math display">\[
\frac{\lambda(t,\mathrm{male})}{\lambda(t,\mathrm{female})}=e^{-\beta}.
\]</span> (Surely, it can be obtained manually as the reciprocal: <code>1/0.5880=1.70068</code>).</p>
<p>In the above, we dealt with one covariate, <code>sex</code>. To deal with several, the corresponding names should be added, e.g.&nbsp;<code>~sex+age</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status)<span class="sc">~</span>sex<span class="sc">+</span>age, <span class="at">data=</span>lung)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fit2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
coxph(formula = Surv(time, status) ~ sex + age, data = lung)

         coef exp(coef)  se(coef)      z       p
sex -0.513219  0.598566  0.167458 -3.065 0.00218
age  0.017045  1.017191  0.009223  1.848 0.06459

Likelihood ratio test=14.12  on 2 df, p=0.0008574
n= 228, number of events= 165 </code></pre>
</div>
</div>
<p>Here, if <span class="math inline">\(z_1\in\{1,2\}\)</span> represents sex and <span class="math inline">\(z_2\in\mathbb{N}\)</span> represents the age, <span class="math display">\[
\dfrac{\lambda(t,z_1,z_2)}{\lambda(t,\tilde{z}_1,\tilde{z}_2)} =\exp\bigl(\beta_1(z_1-\tilde{z}_1)\bigr)\exp\bigl(\beta_2(z_2-\tilde{z}_2)\bigr).
\]</span> As a result, the ratio of hazard rates for the same sex and for two subsequent years is <span class="math display">\[
\dfrac{\lambda(t,z_1,z_2+1)}{\lambda(t,z_1,z_2)} = e^{\beta_2} = 1.017191,
\]</span> i.e.&nbsp;each year increases the hazard rate (again, for the people as in the data set) by approximately <span class="math inline">\(1.7\)</span>%.</p>
<section id="section-6" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="section-6"><span class="header-section-number">5.1</span> </h2>
<div class="task">
<p>Find the ratio of the hazard rate for a male aged 70 to a female aged 80 (for the given data set).</p>
</div>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>Here we need <span class="math display">\[
\dfrac{\lambda(t,z_1=1,z_2=70)}{\lambda(t,z_1=2,z_2=80)} = e^{-\beta_1}e^{-10\beta_2}.
\]</span></p>
</div>
<p>From the output of <code>coxph</code> above, we have that <span class="math inline">\(e^{\beta_1}=0.598566\)</span> and <span class="math inline">\(e^{\beta_2}=1.017191\)</span>, hence, <span class="math display">\[
e^{-\beta_1}e^{-10\beta_2}=0.598566^{-1}\cdot 1.017191^{-10},
\]</span> and we can calculate this:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.598566</span>)<span class="sc">**</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> <span class="fl">1.017191</span><span class="sc">**</span>(<span class="sc">-</span><span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.408844</code></pre>
</div>
</div>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/finkelshtein\.github\.io\/MA-x65\/website\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Lab6-Solutions.html" class="pagination-link" aria-label="Lab 6 - Solutions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Lab 6 - Solutions</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2025, Dmitri Finkelshtein</p>
</div>   
    <div class="nav-footer-center">
<p>MA-365/M65: Lab Assignments</p>
</div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>